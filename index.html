<!DOCTYPE html>
<html>
<head>
    <title>CPU Scheduling Simulator</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 6px;
        }
        .gantt {
            display: flex;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .block {
            border: 1px solid black;
            padding: 10px;
            min-width: 60px;
            text-align: center;
        }
    </style>
</head>
<body>

<h2>CPU Scheduling Simulator</h2>

<label>Algorithm:</label>
<select id="algorithm">
    <option value="fcfs">FCFS</option>
    <option value="sjf">SJF (Non-Preemptive)</option>
    <option value="rr">Round Robin</option>
</select>

<label>Time Quantum (RR only):</label>
<input type="number" id="quantum" value="2">

<br><br>

<h3>Add Process</h3>
<label>Process ID:</label>
<input type="text" id="pid">
<label>Arrival Time:</label>
<input type="number" id="arrival">
<label>Burst Time:</label>
<input type="number" id="burst">
<button onclick="addProcess()">Add</button>

<h3>Process Table</h3>
<table id="processTable">
<tr>
<th>PID</th>
<th>Arrival</th>
<th>Burst</th>
</tr>
</table>

<br>
<button onclick="simulate()">Simulate</button>

<h3>Gantt Chart</h3>
<div id="ganttChart" class="gantt"></div>

<h3>Results</h3>
<table id="resultTable">
<tr>
<th>PID</th>
<th>Waiting Time</th>
<th>Turnaround Time</th>
</tr>
</table>

<h4 id="avgWaiting"></h4>

<script>

let processes = [];

function addProcess() {
    let pid = document.getElementById("pid").value;
    let arrival = parseInt(document.getElementById("arrival").value);
    let burst = parseInt(document.getElementById("burst").value);

    if (!pid || isNaN(arrival) || isNaN(burst)) {
        alert("Enter valid inputs");
        return;
    }

    processes.push({
        pid: pid,
        arrival: arrival,
        burst: burst,
        remaining: burst,
        completion: 0
    });

    let table = document.getElementById("processTable");
    let row = table.insertRow();
    row.insertCell(0).innerHTML = pid;
    row.insertCell(1).innerHTML = arrival;
    row.insertCell(2).innerHTML = burst;

    document.getElementById("pid").value = "";
    document.getElementById("arrival").value = "";
    document.getElementById("burst").value = "";
}

function simulate() {

    if (processes.length === 0) {
        alert("Add processes first");
        return;
    }

    let algo = document.getElementById("algorithm").value;

    processes.forEach(p => {
        p.remaining = p.burst;
        p.completion = 0;
    });

    if (algo === "fcfs") simulateFCFS();
    else if (algo === "sjf") simulateSJF();
    else simulateRR();
}

function simulateFCFS() {

    let time = 0;
    let gantt = [];

    let sorted = [...processes].sort((a,b)=>a.arrival-b.arrival);

    sorted.forEach(p => {
        if (time < p.arrival) time = p.arrival;

        gantt.push({pid:p.pid,start:time,end:time+p.burst});
        time += p.burst;
        p.completion = time;
    });

    displayGantt(gantt);
    calculateTimes();
}

function simulateSJF() {

    let time = 0;
    let completed = 0;
    let n = processes.length;
    let visited = [];
    let gantt = [];

    while (completed < n) {

        let available = processes.filter(p => 
            p.arrival <= time && !visited.includes(p)
        );

        if (available.length === 0) {
            time++;
            continue;
        }

        available.sort((a,b)=>a.burst-b.burst);

        let current = available[0];
        visited.push(current);

        gantt.push({pid:current.pid,start:time,end:time+current.burst});
        time += current.burst;
        current.completion = time;
        completed++;
    }

    displayGantt(gantt);
    calculateTimes();
}

function simulateRR() {

    let quantum = parseInt(document.getElementById("quantum").value);

    if (isNaN(quantum) || quantum <= 0) {
        alert("Enter valid Time Quantum");
        return;
    }

    let time = 0;
    let completed = 0;
    let n = processes.length;
    let queue = [];
    let gantt = [];

    let sorted = [...processes].sort((a,b)=>a.arrival-b.arrival);

    while (completed < n) {

        sorted.forEach(p=>{
            if (p.arrival<=time && p.remaining>0 && !queue.includes(p))
                queue.push(p);
        });

        if (queue.length === 0) {
            time++;
            continue;
        }

        let current = queue.shift();

        let exec = Math.min(quantum,current.remaining);

        gantt.push({pid:current.pid,start:time,end:time+exec});

        time += exec;
        current.remaining -= exec;

        sorted.forEach(p=>{
            if (p.arrival<=time && p.remaining>0 && !queue.includes(p) && p!==current)
                queue.push(p);
        });

        if (current.remaining>0)
            queue.push(current);
        else {
            current.completion = time;
            completed++;
        }
    }

    displayGantt(gantt);
    calculateTimes();
}

function displayGantt(gantt) {

    let chart = document.getElementById("ganttChart");
    chart.innerHTML = "";

    gantt.forEach(b=>{
        let div = document.createElement("div");
        div.className="block";
        div.innerHTML=b.pid+"<br>"+b.start+"-"+b.end;
        chart.appendChild(div);
    });
}

function calculateTimes() {

    let table = document.getElementById("resultTable");
    table.innerHTML = `
    <tr>
    <th>PID</th>
    <th>Waiting Time</th>
    <th>Turnaround Time</th>
    </tr>`;

    let total = 0;

    processes.forEach(p=>{
        let tat = p.completion - p.arrival;
        let wt = tat - p.burst;
        total += wt;

        let row = table.insertRow();
        row.insertCell(0).innerHTML = p.pid;
        row.insertCell(1).innerHTML = wt;
        row.insertCell(2).innerHTML = tat;
    });

    document.getElementById("avgWaiting").innerHTML =
        "Average Waiting Time: " + (total/processes.length).toFixed(2);
}

</script>

</body>
</html>